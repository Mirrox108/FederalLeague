<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход - Federal League</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="form-container">
        <div class="form-box">
            <div class="form-header">
                <img src="images/login-bg.jpg" alt="Federal League" class="form-image" onerror="this.style.display='none'">
                <div class="form-header-overlay">
                    <img src="images/logo.png" alt="Federal League" class="form-logo">
                    <h2>Вход в систему</h2>
                    <p>Federal League - Политический Minecraft сервер</p>
                </div>
            </div>

            <div class="form-content">
                <div class="form-message" id="login-message">
                    <i class="fas fa-exclamation-circle"></i>
                    <span id="message-text"></span>
                </div>

                <form id="login-form">
                    <div class="form-group">
                        <label for="login-email">Email адрес</label>
                        <input type="email" id="login-email" name="email" required placeholder="Введите ваш email">
                    </div>

                    <div class="form-group">
                        <label for="login-password">Пароль</label>
                        <div class="password-input">
                            <input type="password" id="login-password" name="password" required placeholder="Введите ваш пароль">
                            <button type="button" class="toggle-password" id="toggle-password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="remember-me" name="remember">
                            <span>Запомнить меня</span>
                        </label>
                    </div>

                    <button type="submit" class="btn-primary" id="login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        Войти
                    </button>
                </form>

                <div class="form-links">
                    <a href="index.html">
                        <i class="fas fa-home"></i>
                        Вернуться на главную
                    </a>
                    <a href="register.html">
                        <i class="fas fa-user-plus"></i>
                        Зарегистрироваться
                    </a>
                    <a href="#" id="forgot-password">
                        <i class="fas fa-key"></i>
                        Забыли пароль?
                    </a>
                </div>

                <!-- Демо-аккаунты -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,169,57,0.1); border-radius: 8px; border-left: 4px solid var(--main-color);">
                    <h4 style="color: var(--main-color); margin-bottom: 15px; text-align: center;">
                        <i class="fas fa-users"></i> Демо-аккаунты
                    </h4>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px; text-align: center;">
                            <div style="font-weight: bold; color: var(--main-color); margin-bottom: 5px;">Администратор</div>
                            <div style="font-size: 12px; color: var(--description-color);">Email: <strong>admin@federal.ru</strong></div>
                            <div style="font-size: 12px; color: var(--description-color);">Пароль: <strong>admin123</strong></div>
                            <button onclick="fillDemoCredentials('admin@federal.ru', 'admin123')" 
                                    style="margin-top: 8px; padding: 5px 10px; background: var(--main-color); border: none; border-radius: 4px; color: var(--black-color); font-size: 11px; cursor: pointer;">
                                Быстрый вход
                            </button>
                        </div>
                        
                        <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px; text-align: center;">
                            <div style="font-weight: bold; color: var(--main-color); margin-bottom: 5px;">Игрок</div>
                            <div style="font-size: 12px; color: var(--description-color);">Email: <strong>demo@federal.ru</strong></div>
                            <div style="font-size: 12px; color: var(--description-color);">Пароль: <strong>password</strong></div>
                            <button onclick="fillDemoCredentials('demo@federal.ru', 'password')" 
                                    style="margin-top: 8px; padding: 5px 10px; background: var(--main-color); border: none; border-radius: 4px; color: var(--black-color); font-size: 11px; cursor: pointer;">
                                Быстрый вход
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBcPC6rEcNLxXAqcRTEjcWXwXrJ7sj43yQ",
            authDomain: "federalleague-e7452.firebaseapp.com",
            projectId: "federalleague-e7452",
            storageBucket: "federalleague-e7452.firebasestorage.app",
            messagingSenderId: "171537204382",
            appId: "1:171537204382:web:e2bf1a98447d0f039ce78f"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Функция для показа уведомлений
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        // Заполнение демо-credentials
        function fillDemoCredentials(email, password) {
            document.getElementById('login-email').value = email;
            document.getElementById('login-password').value = password;
            document.getElementById('remember-me').checked = true;
            showNotification(`Данные заполнены!`, 'success');
        }

        // Создание демо-аккаунтов
        async function createDemoAccounts() {
            const demoAccounts = [
                { email: 'admin@federal.ru', password: 'admin123', username: 'admin', balance: 10000, level: 50, role: 'administrator' },
                { email: 'demo@federal.ru', password: 'password', username: 'demo', balance: 1500, level: 24, role: 'player' }
            ];

            for (const account of demoAccounts) {
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, account.email, account.password);
                    const user = userCredential.user;
                    
                    await setDoc(doc(db, "users", user.uid), {
                        username: account.username,
                        email: account.email,
                        balance: account.balance,
                        level: account.level,
                        role: account.role,
                        playtime: '127 ч',
                        premium: true,
                        registrationDate: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    });
                    
                } catch (error) {
                    if (error.code !== 'auth/email-already-in-use') {
                        console.log('Демо-аккаунт уже существует или ошибка:', error);
                    }
                }
            }
        }

        // Функция входа
        async function loginUser(email, password) {
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                const userDoc = await getDoc(doc(db, "users", user.uid));
                
                if (!userDoc.exists()) {
                    throw new Error('Данные пользователя не найдены');
                }
                
                const userData = userDoc.data();
                
                return {
                    uid: user.uid,
                    email: user.email,
                    username: userData.username,
                    balance: userData.balance,
                    level: userData.level,
                    playtime: userData.playtime,
                    premium: userData.premium,
                    role: userData.role,
                    registrationDate: userData.registrationDate,
                    lastLogin: new Date().toISOString()
                };
                
            } catch (error) {
                console.error('Ошибка входа:', error);
                throw error;
            }
        }

        // Обработка формы входа
        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const remember = document.getElementById('remember-me').checked;
            
            if (!email || !password) {
                showNotification('Заполните все поля', 'error');
                return;
            }
            
            const loginBtn = document.getElementById('login-btn');
            const originalText = loginBtn.innerHTML;
            
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Вход...';
            loginBtn.disabled = true;
            
            try {
                const user = await loginUser(email, password);
                
                showNotification(`Добро пожаловать, ${user.username}!`, 'success');
                
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                if (remember) {
                    localStorage.setItem('remembered_user', email);
                }
                
                setTimeout(() => {
                    window.location.href = 'account.html';
                }, 1000);
                
            } catch (error) {
                console.error('Ошибка входа:', error);
                
                if (error.code === 'auth/user-not-found') {
                    showNotification('Пользователь не найден', 'error');
                } else if (error.code === 'auth/wrong-password') {
                    showNotification('Неверный пароль', 'error');
                } else if (error.code === 'auth/invalid-email') {
                    showNotification('Неверный формат email', 'error');
                } else {
                    showNotification('Ошибка входа: ' + error.message, 'error');
                }
            } finally {
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        });

        // Переключение видимости пароля
        document.getElementById('toggle-password').addEventListener('click', function() {
            const input = document.getElementById('login-password');
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });

        // Проверка при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            createDemoAccounts();
            
            const rememberedUser = localStorage.getItem('remembered_user');
            if (rememberedUser) {
                document.getElementById('login-email').value = rememberedUser;
                document.getElementById('remember-me').checked = true;
            }
        });

        // Обработка "Забыли пароль?"
        document.getElementById('forgot-password').addEventListener('click', function(e) {
            e.preventDefault();
            showNotification('Функция восстановления пароля временно недоступна', 'warning');
        });
    </script>
</body>
</html>
